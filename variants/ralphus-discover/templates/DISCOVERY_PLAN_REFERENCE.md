# Discovery Plan

> Generated by `ralphus-discover plan` on {DATE}
> Branch: {BRANCH}

## Summary

| Category | Total | Discovered | Remaining | Progress |
|----------|-------|------------|-----------|----------|
| Architecture | 0 | 0 | 0 | 0% |
| Patterns | 0 | 0 | 0 | 0% |
| Conventions | 0 | 0 | 0 | 0% |
| Data Flow | 0 | 0 | 0 | 0% |
| Tricks & Quirks | 0 | 0 | 0 | 0% |
| **Total** | **0** | **0** | **0** | **0%** |

---

## Phase 1: Architecture (The Big Picture)

Understanding the structural foundation before diving into details.

- [ ] What is the primary purpose of this codebase? (1 sentence)
- [ ] What are the main entry points? (CLI, API, UI, workers, etc.)
- [ ] What is the directory structure philosophy? (by feature, by layer, hybrid?)
- [ ] What are the core modules/packages and their responsibilities?
- [ ] What external services/APIs does this depend on?
- [ ] What is the deployment model? (monolith, microservices, serverless?)
- [ ] What is the build/compilation pipeline?

## Phase 2: Patterns (How Things Are Done)

Identifying recurring solutions and idioms.

- [ ] What design patterns are used? (Repository, Factory, Observer, etc.)
- [ ] How is dependency injection handled?
- [ ] How is configuration managed? (env vars, config files, feature flags?)
- [ ] How is error handling standardized?
- [ ] How is logging structured?
- [ ] How is authentication/authorization implemented?
- [ ] How are database operations abstracted?
- [ ] How is state management handled? (if frontend)
- [ ] How are async operations managed? (promises, queues, workers?)

## Phase 3: Conventions (The Unwritten Rules)

The implicit agreements that make the codebase consistent.

- [ ] What naming conventions are used? (files, functions, variables, classes)
- [ ] What is the file organization pattern within modules?
- [ ] How are tests organized and named?
- [ ] What is the commit message format?
- [ ] What is the branching strategy?
- [ ] How are imports ordered?
- [ ] What code style rules are enforced? (linter config)
- [ ] How are types/interfaces organized?
- [ ] What documentation conventions exist? (JSDoc, docstrings, README per module?)

## Phase 4: Data Flow (How Information Moves)

Tracing the journey of data through the system.

- [ ] What are the primary data models/entities?
- [ ] How does data enter the system? (API, events, files, user input)
- [ ] How does data flow between layers/modules?
- [ ] Where is data persisted? (DB, cache, files, external services)
- [ ] How is data validated at boundaries?
- [ ] What transformations happen to data?
- [ ] How is data serialized/deserialized?
- [ ] What are the critical data paths? (happy path for main use cases)

## Phase 5: Tricks & Quirks (The Tribal Knowledge)

The non-obvious things that only experience reveals.

- [ ] What workarounds exist and why?
- [ ] What are the known gotchas for new developers?
- [ ] What performance optimizations are in place?
- [ ] What are the "magic" values or special cases?
- [ ] What legacy decisions still affect the codebase?
- [ ] What are the testing tricks? (mocks, fixtures, test utilities)
- [ ] What debugging techniques work best here?
- [ ] What are the common failure modes?
- [ ] What undocumented features exist?

## Phase 6: Follow-ups (Discovered During Exploration)

<!-- Questions added during discovery iterations -->
<!-- These are processed FIRST (depth-first exploration) -->
<!-- Each discovery should add 1-2 follow-ups here -->

---

## Discoveries Log

<!-- Each discovery iteration adds an entry here -->
<!-- Track follow-up count to detect exhaustion (3 consecutive 0s = exhausted) -->

| # | Question | Discovery File | Follow-ups | Status |
|---|----------|----------------|------------|--------|
| 1 | | | | |

---

## Exhaustion Criteria

The discovery loop completes when:
1. **Primary**: 3 consecutive discoveries generate 0 follow-up questions (codebase exhausted)
2. **Secondary**: All questions answered AND no pending follow-ups
3. **Manual**: `<promise>COMPLETE</promise>` signal

**How to detect**: Check the "Follow-ups" column in Discoveries Log. If the last 3 entries are all "0", the codebase is exhausted.

## Output Artifacts

- `discoveries/` — Individual discovery files (one per question)
- `CODEBASE_UNDERSTANDING.md` — Synthesized understanding document
- `PATTERNS.md` — Catalog of identified patterns
- `CONVENTIONS.md` — Documented conventions
- `GOTCHAS.md` — Tricks, quirks, and tribal knowledge
