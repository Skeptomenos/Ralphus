# Ralphus Discover

> *"What is the core abstraction of this codebase?"*

**Ralphus Discover** systematically explores and documents a codebase. Instead of implementing features, it builds understanding. Each iteration answers one question about the codebase, documents the discovery, and generates follow-up questions.

## The Idea

> "Onboarding to a new codebase shouldn't take weeks. Run ralphus-discover in a loop, have it commit each discovery in thin commits, read each commit. Super fast way to understand any codebase. The goal isn't code—it's to build your mental model of how everything fits together."

## How It Works

```
┌─────────────────────────────────────────────────────────────────┐
│                    THE DISCOVERY CYCLE                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│    ┌──────────┐     ┌──────────┐     ┌──────────┐              │
│    │  Pick    │────▶│ Explore  │────▶│  Commit  │              │
│    │ Question │     │ Codebase │     │ Discovery│              │
│    └──────────┘     └──────────┘     └──────────┘              │
│         ▲                │                 │                    │
│         │                ▼                 │                    │
│         │         ┌──────────┐             │                    │
│         │         │ Generate │             │                    │
│         └─────────│ Follow-  │◀────────────┘                    │
│                   │   ups    │                                  │
│                   └──────────┘                                  │
│                                                                 │
│    "I choo-choo-choose to understand this architecture!"       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

Each iteration:
1. **Agent wakes up** with no memory of previous iterations
2. **Reads the plan** (DISCOVERY_PLAN.md) to find the next question
3. **Explores the codebase** using search, file reading, git history
4. **Documents the discovery** with evidence and implications
5. **Generates follow-up questions** (0-2 per discovery)
6. **Commits** the discovery
7. **Context clears** and the loop repeats

## Discovery Categories

| Category | What It Reveals |
|----------|-----------------|
| **Architecture** | Entry points, modules, dependencies, deployment model |
| **Patterns** | Design patterns, error handling, async model, data access |
| **Conventions** | Naming, file organization, testing, git workflow |
| **Data Flow** | Entities, transformations, validation, critical paths |
| **Tricks & Quirks** | Workarounds, gotchas, optimizations, tribal knowledge |

## Quick Start

```bash
# Copy to your project
cp -r path/to/ralphus/variants/ralphus-discover ./ralphus/ralphus-discover

# Phase 1: Generate discovery plan (tailored to this codebase)
./ralphus/ralphus-discover/scripts/loop.sh plan

# Phase 2: Run discovery loop
./ralphus/ralphus-discover/scripts/loop.sh
```

## Directory Requirements

Your project will have these after running:
```
your-project/
├── DISCOVERY_PLAN.md              # Generated by plan mode
├── discoveries/                   # Individual discovery files
│   ├── 001-entry-points.md
│   ├── 002-error-handling.md
│   └── ...
├── CODEBASE_UNDERSTANDING.md      # Synthesized at completion
├── PATTERNS.md                    # Catalog of patterns
├── CONVENTIONS.md                 # Documented conventions
├── GOTCHAS.md                     # Tricks and tribal knowledge
└── ralphus/
    └── ralphus-discover/          # This variant
```

## Usage

```bash
./ralphus/ralphus-discover/scripts/loop.sh plan        # Generate discovery plan
./ralphus/ralphus-discover/scripts/loop.sh             # Run discovery (unlimited)
./ralphus/ralphus-discover/scripts/loop.sh 30          # Max 30 discoveries
./ralphus/ralphus-discover/scripts/loop.sh ulw         # Ultrawork mode
```

## Seed Questions

The planning phase generates questions tailored to your codebase, but here are the default categories:

### Architecture (The Big Picture)
- What is the primary purpose of this codebase?
- What are the main entry points?
- What is the directory structure philosophy?
- What are the core modules and their responsibilities?
- What external services does this depend on?

### Patterns (How Things Are Done)
- What design patterns are used?
- How is dependency injection handled?
- How is error handling standardized?
- How is authentication/authorization implemented?
- How are async operations managed?

### Conventions (The Unwritten Rules)
- What naming conventions are used?
- How are tests organized and named?
- What is the commit message format?
- How are imports ordered?
- What documentation conventions exist?

### Data Flow (How Information Moves)
- What are the primary data models?
- How does data enter the system?
- How does data flow between layers?
- What transformations happen to data?
- What are the critical data paths?

### Tricks & Quirks (Tribal Knowledge)
- What workarounds exist and why?
- What are the known gotchas?
- What performance optimizations are in place?
- What are the "magic" values or special cases?
- What debugging techniques work best here?

## Output Artifacts

| Artifact | Purpose |
|----------|---------|
| `discoveries/*.md` | Individual discovery files with evidence |
| `CODEBASE_UNDERSTANDING.md` | Synthesized overview document |
| `PATTERNS.md` | Catalog of identified patterns |
| `CONVENTIONS.md` | Documented conventions |
| `GOTCHAS.md` | Tricks, quirks, and tribal knowledge |

## Completion Signals

| Signal | Meaning |
|--------|---------|
| `<promise>PLAN_COMPLETE</promise>` | Discovery plan generated |
| `<promise>PHASE_COMPLETE</promise>` | One discovery done, loop continues |
| `<promise>COMPLETE</promise>` | All discoveries done, synthesis complete |
| `<promise>BLOCKED:[question]:[reason]</promise>` | Stuck, needs help |

## Exhaustion Criteria

The loop completes when:
1. All seed questions answered
2. No new follow-up questions for 3 consecutive iterations
3. Synthesis documents created

## Use Cases

- **Onboarding**: New developer joining a team
- **Due Diligence**: Evaluating an acquisition target
- **Audit**: Understanding a legacy codebase before refactoring
- **Documentation**: Generating docs for an undocumented project
- **Knowledge Transfer**: Capturing tribal knowledge before someone leaves

## Reading the Commits

The magic is in the git history. Each commit is one discovery:

```bash
git log --oneline
# abc1234 Discover: Authentication uses JWT with refresh tokens
# def5678 Discover: All API routes go through middleware chain
# ghi9012 Discover: Entry point is src/main.ts

# Read a specific discovery
git show abc1234
```

## Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `RALPH_AGENT` | `Sisyphus` | OpenCode agent to use |
| `OPENCODE_BIN` | `opencode` | Path to OpenCode binary |

## License

MIT — Discover whatever you want. Ralphus certainly will.
